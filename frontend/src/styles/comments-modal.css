/* comments-modal.css
   Facebook-like full-screen comments modal
   - less dark
   - rounded media on desktop
   - responsive: desktop -> 2 columns, mobile -> stacked single column
*/

/* Backdrop */
.cm-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.45); /* moins sombre */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20000;
  -webkit-backdrop-filter: blur(5px);
  backdrop-filter: blur(5px);
  overflow-x: hidden;
}

/* On mobile, start at the top and allow scrolling so nothing gets cut off */
@media (max-width: 880px) {
  .cm-backdrop {
    align-items: flex-start;
    overflow-y: auto;
    padding: 12px;
  }
}

/* Container */
.cm-container {
  width: min(94%, 1180px);
  max-width: calc(100vw - 12px);
  height: calc(100vh - 40px);
  background: linear-gradient(180deg,#111217,#0f1316); /* un peu plus lumineux */
  border-radius: 14px;
  display: grid;
  grid-template-columns: 1fr 420px;
  gap: 18px;
  padding: 18px;
  box-shadow: 0 18px 60px rgba(7,10,12,0.6);
  overflow: hidden;
  color: #e6eef9;
  position: relative;
  box-sizing: border-box;
}

.cm-container *,
.cm-container *::before,
.cm-container *::after {
  box-sizing: border-box;
  max-width: 100%;
}

/* Mobile: single column stacked */
@media (max-width: 880px) {
  .cm-container {
    display: block;
    height: auto;
    min-height: calc(100vh - 24px);
    width: 100%;
    max-width: 100%;
    border-radius: 12px;
    padding: 12px;
    overflow: visible;
  }
}

/* Left (post preview) */
.cm-left {
  overflow-y: auto;
  padding-right: 6px;
  -webkit-overflow-scrolling: touch;
}

/* Right (comments) */
.cm-right {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-left: 1px solid rgba(255,255,255,0.03);
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  max-width: 100%;
}

/* When mobile stacked, show right below post and full width */
@media (max-width: 880px) {
  .cm-right {
    margin-top: 12px;
    border-left: none;
    border-top: 1px solid rgba(255,255,255,0.03);
    border-radius: 10px;
  }
}

/* Close button */
.cm-close {
  position: absolute;
  right: 18px;
  top: 14px;
  background: rgba(255,255,255,0.04);
  border: none;
  color: #f2f4f7;
  font-size: 20px;
  padding: 6px 10px;
  border-radius: 8px;
  cursor: pointer;
  z-index: 3;
}

/* Post header */
.cm-post-header {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-bottom: 12px;
}
.cm-avatar, .cm-comment-avatar, .cm-reply-avatar {
  width: 44px;
  height: 44px;
  border-radius: 999px;
  background: linear-gradient(135deg,#2b2b2b,#404040);
  background-size: cover !important;
  background-position: center !important;
  flex-shrink: 0;
}
.cm-post-meta { display: flex; flex-direction: column; gap: 4px; }
.cm-post-author { font-weight: 800; font-size: 15px; color: #f6f8fb; }
.cm-post-date { font-size: 12px; color: #9aa0a6; }

/* Post text container */
.cm-post-text-wrap {
  margin-bottom: 12px;
  overflow: hidden;
  --collapsed: 160px;
  --expanded: 1600px;
  transition: max-height .32s cubic-bezier(.2,.9,.2,1), opacity .28s ease;
  max-height: var(--collapsed);
  opacity: 1;
}
.cm-post-text-wrap.expanded { max-height: var(--expanded); }
.cm-post-text {
  white-space: pre-wrap;
  line-height: 1.5;
  color: #e6eef9;
  font-size: 15px;
  padding-right: 6px;
}
.cm-toggle-text {
  margin-top: 8px;
  background: none;
  border: none;
  color: #63a0ff;
  cursor: pointer;
  font-weight: 700;
}

/* Post media (carousel) */
.cm-post-media {
  margin-top: 10px;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  min-height: 180px;
  background: transparent;
}
.cm-media-current {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.cm-media-current img,
.cm-media-current video {
  width: 100%;
  max-width: 820px;
  border-radius: 14px; /* arrondi plus visible desktop */
  max-height: 70vh;
  object-fit: contain;
  background: #000;
  display: block;
}

/* nav arrows */
.cm-media-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.45);
  border: none;
  color: #fff;
  width: 40px;
  height: 40px;
  border-radius: 999px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 4;
  transition: opacity .14s;
}
.cm-media-prev { left: 12px; }
.cm-media-next { right: 12px; }

/* counter */
.cm-media-counter {
  position: absolute;
  bottom: 12px;
  right: 12px;
  background: rgba(0,0,0,0.45);
  padding: 6px 8px;
  border-radius: 999px;
  font-size: 12px;
  color: #e6eef9;
}

/* Right column header */
.cm-right-header { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:space-between; }
.cm-title { font-weight:800; font-size:16px; color:#f4f6fb; }

/* Comments list */
.cm-comments {
  flex:1;
  overflow-y: auto;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  -webkit-overflow-scrolling: touch;
  overflow-x: hidden;
}

/* Load more */
.cm-load-more-row { display:flex; justify-content:center; padding:8px 0; }
.cm-load-more { background:none; border:1px solid rgba(255,255,255,0.04); padding:8px 12px; border-radius:10px; color:#bcd6ff; cursor:pointer; }

/* Skeleton */
.cm-skeleton { display:flex; gap:10px; align-items:flex-start; }
.cm-sk-avatar { width:40px; height:40px; border-radius:999px; background:linear-gradient(90deg,#27282a,#333437); }
.cm-sk-lines { flex:1; }
.cm-sk-line { height:10px; background:linear-gradient(90deg,#2a2a2a,#3a3a3a); border-radius:6px; margin-bottom:8px; }
.cm-sk-line.long { width:65%; }
.cm-sk-line.short { width:40%; }

/* comment */
.cm-comment-wrap { display:flex; gap:12px; align-items:flex-start; }
.cm-comment { display:flex; gap:10px; width:100%; }
.cm-comment-avatar { width:38px; height:38px; border-radius:999px; background-size:cover; background-position:center; }
.cm-comment-body { flex:1; display:flex; flex-direction:column; gap:8px; max-width: 100%; }
.cm-comment-bubble { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:10px 12px 26px 12px; border-radius:12px; position:relative; transition: max-height .28s ease, transform .18s ease; overflow:hidden; max-height: 220px; width: fit-content; max-width: 92%; }
.cm-comment-bubble.expanded { max-height: 2000px; }

/* author row */
.cm-comment-author-row { display:flex; gap:8px; align-items:center; margin-bottom:6px; }
.cm-comment-author { font-weight:800; color:#eef4ff; }
.cm-comment-date { font-size:12px; color:#9aa0a6; margin-left:auto; }

/* text */
.cm-comment-text { white-space:pre-wrap; color:#dbeafe; line-height:1.45; }

/* media in comment: show full scaled - not cropped */
.cm-comment-media img,
.cm-comment-media video {
  width: 100%;
  max-width: 320px;   /* desktop comment media reasonable width */
  height: auto;
  object-fit: contain; /* important: do not crop */
  border-radius: 10px;
  background: #000;
  display: block;
}

/* small screens reduce media size */
@media (max-width: 480px) {
  .cm-comment-media img,
  .cm-comment-media video {
    max-width: 220px;
  }
}

/* actions */
.cm-comment-actions-row { display:flex; gap:8px; align-items:center; color:#b8c7d9; font-size:13px; }
.cm-action { background:none; border:none; color:#a9bfdc; cursor:pointer; padding:6px 8px; border-radius:8px; }
.cm-action:hover { background: rgba(255,255,255,0.02); }

/* reaction picker & pills */
.cm-reaction-picker { display:flex; gap:6px; margin-top:6px; }
.cm-reaction-pill {
  background: linear-gradient(135deg, rgba(33,57,90,0.95), rgba(20,37,62,0.95));
  border:1px solid rgba(255,255,255,0.08);
  color:#f0f5ff;
  padding:6px 9px;
  border-radius:14px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  font-size:13px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.22);
  transition: background 0.16s ease, transform 0.12s ease, box-shadow 0.16s ease;
}
.cm-reaction-pill:hover { background: linear-gradient(135deg, rgba(46,74,112,0.98), rgba(28,50,82,0.98)); transform: translateY(-1px); box-shadow: 0 8px 16px rgba(0,0,0,0.28); }
.cm-reaction-badge {
  position:absolute;
  right:10px;
  bottom:6px;
  display:inline-flex;
  align-items:center;
  gap:6px;
  background: rgba(19,34,56,0.92);
  border:1px solid rgba(255,255,255,0.09);
  padding:3px 7px;
  border-radius:12px;
  font-size:13px;
  color:#f4f7ff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.cm-reaction-icons { display:flex; gap:4px; }
.cm-reaction-icon { font-size:15px; }
.cm-reaction-count { font-weight:700; }

/* small dropdown (delete) */
.cm-dropdown {
  margin-top:8px;
  background:#141518;
  border-radius:8px;
  padding:6px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  width: 120px;
}
.cm-dropdown .danger {
  color:#ff6b6b;
  background:none;
  border:none;
  cursor:pointer;
  width:100%;
  text-align:left;
  padding:8px;
  font-size:13px;
  border-radius:6px;
}

/* reply input */
.cm-reply-input-row {
  display: flex;
  gap: 8px;
  align-items: center;
  margin-top: 8px;
  flex-wrap: wrap;
}
.cm-upload-btn { background:none; border:none; cursor:pointer; color:#b7d0ff; padding:6px; font-size:18px; }
.cm-reply-input-wrapper {
  position: relative;
  flex: 1 1 200px;
  min-width: 0;
}
.cm-reply-input {
  background: #0d1620;
  border: 1px solid rgba(255,255,255,0.03);
  padding: 8px 44px 8px 12px;
  border-radius: 8px;
  color: #e5f0ff;
}

/* reply list */
.cm-reply { display:flex; gap:8px; margin-top:10px; }
.cm-reply-avatar { width:32px; height:32px; border-radius:999px; background-size:cover; background-position:center; }
.cm-reply-body { flex:1; background: #0b1220; padding:8px 10px 28px 10px; border-radius:10px; position: relative; }
.cm-reply-author { font-weight:700; color:#e8f3ff; }
.cm-reply-text { color:#dbeafe; margin-top:4px; }

/* reply media */
.cm-reply-media img, .cm-reply-media video { width:140px; border-radius:8px; max-height:120px; object-fit:contain; }

/* bottom input */
.cm-input-bar {
  display:flex;
  gap:8px;
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,0.02);
  align-items:center;
  flex-wrap: wrap;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  max-width: 100%;
  overflow-x: hidden;
}
.cm-input-wrapper {
  position: relative;
  flex: 1;
  min-width: 0;
}
.cm-text-input {
  width: 100%;
  background:#0d1620;
  border:1px solid rgba(255,255,255,0.03);
  color:#e6f1ff;
  padding:10px 48px 10px 12px;
  border-radius:12px;
}
.cm-send-btn {
  background:#2d7bff;
  color:white;
  border:none;
  padding:8px 10px;
  border-radius:999px;
  cursor:pointer;
  min-width: 42px;
  width: auto;
  flex-shrink: 0;
  font-weight: 700;
  font-size: 13px;
}
.cm-send-btn.small { padding:6px 8px; font-size:12px; }
.cm-send-btn.inside {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: transparent;
  padding: 6px;
  min-width: auto;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  transition: background 0.15s ease;
}
.cm-send-btn.inside:hover { background: rgba(45,123,255,0.12); }
.cm-send-btn.inside svg { width: 20px; height: 20px; fill: #1877f2; }

  @media (max-width: 520px) {
    .cm-input-bar {
      flex-wrap: wrap;
      gap: 8px;
    }
  .cm-upload-btn {
    flex-shrink: 0;
  }
  .cm-text-input {
    flex: 1 1 auto;
    min-width: 0;
  }
  .cm-send-btn {
    padding: 8px 10px;
    min-width: 44px;
  }
  .cm-send-btn.inside {
    padding: 6px;
    min-width: auto;
    width: 36px;
    height: 36px;
  }
}

/* preview media above input */
.cm-comment-preview,
.cm-reply-preview { padding:10px 12px; }
.cm-comment-preview-media,
.cm-reply-preview-media { max-width:140px; max-height:100px; border-radius:8px; object-fit:cover; }

/* small utilities */
.muted { color:#98a0a8; }
.small { font-size:12px; }

/* safe area */
@supports(padding: env(safe-area-inset-bottom)) {
  .cm-container { padding-bottom: calc(env(safe-area-inset-bottom) + 18px); }
  .cm-input-bar { padding-bottom: calc(env(safe-area-inset-bottom) + 12px); }
  .cm-close { top: calc(10px + env(safe-area-inset-top)); right: 18px; }
}